---
- name: Install systools packages
  apt: "name={{ item }} state=installed"
  with_items:
    - "{{ systools_packages }}"

- name: Bash global aliases
  lineinfile:
    dest: "{{ systools_bash_aliases_path }}"
    create: yes
    mode: 0644
    line: 'alias {{ item.alias }}="{{ item.command }}"'
    regexp: "^alias {{ item.alias }}="
  with_items:
    - "{{ systools_bash_aliases }}"
  when: systools_bash_aliases != false

- name: Cronjobs
  cron: name="{{ item.name }}"
        minute="{{ item.minute }}"
        hour="{{item.hour}}"
        job="{{ item.job }}"
        state="{{ item.state }}"
        user="{{ item.user }}"
  with_items:
    - "{{ systools_cronjobs }}"
  when: systools_cronjobs != false


- name: Environment settings
  lineinfile:
    dest: /etc/environment
    line: "{{ systools_lc_all }}"
    regexp: "^LC_ALL"
    state: present

- name: GIT global configuration
  template:
    src: gitconfig.j2
    dest: "{{ systools_git_configfile }}"
    group: root
    owner: root
    mode: 0644
  when: systools_git_configfile != false

- name: History store immediatly with formatted time
  lineinfile:
    dest: /etc/bash.bashrc
    line: "{{ item }}"
    regexp: "^{{ item }}"
  with_items:
    - "{{ systools_history }}"

- name: Set authorized_keys for users
  authorized_key:
    exclusive: "{{ item.exclusive }}"
    key: "{{ item.key }}"
    state: present
    user: "{{ item.user }}"
    validate_certs: False
  with_items:
    - "{{ authorized_keys }}"
  when: authorized_keys != false
